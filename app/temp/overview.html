<!DOCTYPE html>
<html lang="en-US" data-bs-theme="auto">
  <head>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>app/overview</title>

    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='media/favicon-16.ico') }}">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <link rel="stylesheet" href="{{ url_for('static', filename='styles/core.style.css') }}">

    <style>
      body {
          background-color: #f8f9fa;
          height: 100vh;
          overflow: hidden;
      }
      .sidebar {
          height: 100vh;
          padding: 20px;
          background-color: #343a40;
          color: #f8f9fa;
          overflow-y: auto;
      }
      .sidebar a {
          color: #f8f9fa;
          text-decoration: none;
          display: block;
          margin: 15px 0;
      }
      .content {
          padding: 20px;
          height: 100vh;
          overflow-y: auto;
      }
      .info-block {
          background-color: #5c636a;
          border-radius: 10px;
          padding: 20px;
          margin-bottom: 20px;
          text-align: center;
          align-items: center;
      }
      .info-block p, .info-block h5 {
          color: #f8f9fa;
      }
      .info-block h5 {
          font-size: 18px;
          margin-bottom: 20px;
      }
      canvas {
          width: 250px !important;
          height: 250px !important;
          background-color: #5c636a;
      }
    </style>

  </head>
  <body>

    <div class="container-fluid">
      <div class="row">
        <nav class="col-md-3 col-lg-2 d-md-block sidebar">
          <div class="text-center">
            <h4>dashboard-engine</h4>
            <h5>version: 0.0.2-a (alpha)</h5>
          </div>
          <a href="#" class="btn btn-secondary">
            <i class="bi bi-cpu-fill" style="color: #f8f9fa;"></i> Overview
          </a>
          <a href="/explorer" class="btn btn-secondary">
            <i class="bi bi-folder-fill" style="color: #f8f9fa;"></i> Explorer
          </a>
          <a href="/terminal" class="btn btn-secondary">
            <i class="bi bi-terminal-fill" style="color: #f8f9fa;"></i> Terminal
          </a>
          <a href="/modules" class="btn btn-secondary">
            <i class="bi bi-box-fill" style="color: #f8f9fa;"></i> Modules
          </a>
          <a href="/settings" class="btn btn-secondary">
            <i class="bi bi-gear-fill" style="color: #f8f9fa;"></i> Settings
          </a>
        </nav>

        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 content">
          <div class="row">
            <div class="col-md-10">
              <div class="info-block" style="height: 440px;">
                <h5>Journal</h5>
                <div>
                  <!-- stub block -->
                </div>
              </div>
            </div>
            <div class="col-md-2">
              <div class="info-block" style="height: 440px;">
                <h5>Info</h5>
                <div>
                  <!-- stub block -->
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-5">
              <div class="info-block" style="height: 400px;">
                <h5>CPU & GPU (Load)</h5>
                <div style="display: flex; justify-content: center;">
                  <div style="text-align: center; margin-right: 20px;">
                    <canvas id="cpuLoadChart"></canvas>
                    <p style="margin-top: 10px;">CPU</p>
                  </div>
                  <div style="text-align: center;">
                    <canvas id="gpuLoadChart"></canvas>
                    <p style="margin-top: 10px;">GPU</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-5">
              <div class="info-block" style="height: 400px;">
                <h5>Memory & Swap (Usage)</h5>
                <div style="display: flex; justify-content: center;">
                  <div style="text-align: center; margin-right: 20px;">
                    <canvas id="memoryChart"></canvas>
                    <p style="margin-top: 10px;">Memory</p>
                  </div>
                  <div style="text-align: center;">
                    <canvas id="swapChart"></canvas>
                    <p style="margin-top: 10px;">Swap</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-2">
              <div class="info-block" style="height: 400px;">
                <h5>Controls</h5>
                <div>
                  <!-- stub block -->
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/socket.io-client/dist/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.30.1/moment.min.js"></script>

    <script src="{{ url_for('static', filename='scripts/core.script.js') }}"></script>

    <script>
      const socket = io();

      const createDoughnutChart = (ctx, label, borderColor) => {
        return new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: ['Used', 'Free'],
            datasets: [{
              label: label,
              data: [0, 100],
              backgroundColor: [borderColor, 'rgba(200, 200, 200, 0.5)'],
              borderColor: borderColor,
              borderWidth: 2,
            }]
          },
          options: {
            responsive: true,
            cutout: '70%',
            plugins: {
              legend: {
                display: true,
                labels: {
                  color: '#ffffff'
                }
              },
              tooltip: {
                enabled: false
              },
              centerText: {
                display: true,
              }
            }
          },
          plugins: [{
            id: 'centerText',
            beforeDraw: function(chart) {
              const ctx = chart.ctx;
              const width = chart.width;
              const height = chart.height;
              const fontSize = Math.min(width, height) / 12;
              const text = chart.data.datasets[0].data[0] + '%';
              ctx.restore();
              ctx.font = fontSize + "px sans-serif";
              ctx.textBaseline = "middle";
              ctx.fillStyle = "#ffffff";
              const textX = Math.round((width - ctx.measureText(text).width) / 2);
              const textY = height / 1.8;
              ctx.fillText(text, textX, textY);
              ctx.save();
            }
          }]
        });
      };

      const cpuLoadCtx = document.getElementById('cpuLoadChart').getContext('2d');
      const gpuLoadCtx = document.getElementById('gpuLoadChart').getContext('2d');
      const memoryCtx = document.getElementById('memoryChart').getContext('2d');
      const swapCtx = document.getElementById('swapChart').getContext('2d');

      const cpuLoadChart = createDoughnutChart(cpuLoadCtx, 'CPU Load (%)', 'rgba(75, 192, 192, 1)');
      const gpuLoadChart = createDoughnutChart(gpuLoadCtx, 'GPU Load (%)', 'rgba(255, 99, 132, 1)');
      const memoryChart = createDoughnutChart(memoryCtx, 'Memory Usage (%)', 'rgba(54, 162, 235, 1)');
      const swapChart = createDoughnutChart(swapCtx, 'Swap Usage (%)', 'rgba(255, 206, 86, 1)');

      socket.on('system_data', (data) => {
        cpuLoadChart.data.datasets[0].data = [data.cpu_used, 100 - data.cpu_used];
        gpuLoadChart.data.datasets[0].data = [data.gpu_used, 100 - data.gpu_used];
        memoryChart.data.datasets[0].data = [data.memory_used, 100 - data.memory_used];
        swapChart.data.datasets[0].data = [data.swap_used, 100 - data.swap_used];

        cpuLoadChart.update();
        gpuLoadChart.update();
        memoryChart.update();
        swapChart.update();
      });
    </script>

  </body>
</html>
